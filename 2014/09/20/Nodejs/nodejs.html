<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Node.js 概述 | Drupal 笔记</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="简介Node.js是JavaScript在服务器端的一个运行环境，也是一个工具库，用来与服务器端其他软件互动。它的JavaScript解释器，采用了Google公司的V8引擎。
安装与更新访问官方网站nodejs.org了解安装细节。
安装完成以后，运行下面的命令，查看是否能正常运行。
1234node --version// 或者node -v
更新node.js版本，可以通过node.js的n">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.js 概述">
<meta property="og:url" content="http://ddnode.com/2014/09/20/Nodejs/nodejs.html">
<meta property="og:site_name" content="Drupal 笔记">
<meta property="og:description" content="简介Node.js是JavaScript在服务器端的一个运行环境，也是一个工具库，用来与服务器端其他软件互动。它的JavaScript解释器，采用了Google公司的V8引擎。
安装与更新访问官方网站nodejs.org了解安装细节。
安装完成以后，运行下面的命令，查看是否能正常运行。
1234node --version// 或者node -v
更新node.js版本，可以通过node.js的n">
<meta property="og:updated_time" content="2014-09-20T03:10:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node.js 概述">
<meta name="twitter:description" content="简介Node.js是JavaScript在服务器端的一个运行环境，也是一个工具库，用来与服务器端其他软件互动。它的JavaScript解释器，采用了Google公司的V8引擎。
安装与更新访问官方网站nodejs.org了解安装细节。
安装完成以后，运行下面的命令，查看是否能正常运行。
1234node --version// 或者node -v
更新node.js版本，可以通过node.js的n">
  
    <link rel="alternative" href="/atom.xml" title="Drupal 笔记" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="//lib.sinaapp.com/js/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/avatar.jpeg">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Boy</a></h1>
		</hgroup>

		
		<p class="header-subtitle">记录生活学习中的点点滴滴</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/tags/前端">前端</a></li>
				        
							<li><a href="/tags/Drupal">Drupal</a></li>
				        
							<li><a href="http://blog.ddnode.com">旧站</a></li>
				        
							<li><a href="/about/index.html">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/ddnode" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/nodewebs" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Compass/" style="font-size: 11.67px;">Compass</a> <a href="/tags/Drupal/" style="font-size: 16.67px;">Drupal</a> <a href="/tags/Nginx/" style="font-size: 13.33px;">Nginx</a> <a href="/tags/Placeholder/" style="font-size: 10px;">Placeholder</a> <a href="/tags/Sass/" style="font-size: 18.33px;">Sass</a> <a href="/tags/Theme/" style="font-size: 10px;">Theme</a> <a href="/tags/Tools/" style="font-size: 10px;">Tools</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/laravel/" style="font-size: 10px;">laravel</a> <a href="/tags/中级/" style="font-size: 13.33px;">中级</a> <a href="/tags/函数/" style="font-size: 10px;">函数</a> <a href="/tags/列表/" style="font-size: 10px;">列表</a> <a href="/tags/初级/" style="font-size: 15px;">初级</a> <a href="/tags/前端/" style="font-size: 20px;">前端</a> <a href="/tags/变量/" style="font-size: 11.67px;">变量</a> <a href="/tags/嵌套/" style="font-size: 10px;">嵌套</a> <a href="/tags/技巧/" style="font-size: 10px;">技巧</a> <a href="/tags/正则/" style="font-size: 10px;">正则</a> <a href="/tags/组织项目/" style="font-size: 10px;">组织项目</a> <a href="/tags/译文/" style="font-size: 10px;">译文</a> <a href="/tags/选择器/" style="font-size: 10px;">选择器</a> <a href="/tags/雪碧图/" style="font-size: 10px;">雪碧图</a> <a href="/tags/项目管理/" style="font-size: 10px;">项目管理</a> <a href="/tags/高级/" style="font-size: 10px;">高级</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Boy</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/avatar.jpeg">
				<hgroup>
				  <h1 class="header-author">Boy</h1>
				</hgroup>
			</div>
			
			<p class="header-subtitle">记录生活学习中的点点滴滴</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/tags/前端">前端</a></li>
		        
					<li><a href="/tags/Drupal">Drupal</a></li>
		        
					<li><a href="http://blog.ddnode.com">旧站</a></li>
		        
					<li><a href="/about/index.html">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/ddnode" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/nodewebs" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Nodejs/nodejs" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/09/20/Nodejs/nodejs.html" class="article-date">
  	<time datetime="2014-09-19T16:00:00.000Z" itemprop="datePublished">2014-09-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Node.js 概述
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/nodejs/">nodejs</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Node.js是JavaScript在服务器端的一个运行环境，也是一个工具库，用来与服务器端其他软件互动。它的JavaScript解释器，采用了Google公司的V8引擎。</p>
<h3 id="安装与更新"><a href="#安装与更新" class="headerlink" title="安装与更新"></a>安装与更新</h3><p>访问官方网站<a href="http://nodejs.org" target="_blank" rel="external">nodejs.org</a>了解安装细节。</p>
<p>安装完成以后，运行下面的命令，查看是否能正常运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">node --version</div><div class="line">// 或者</div><div class="line">node -v</div></pre></td></tr></table></figure>
<p>更新node.js版本，可以通过node.js的n模块完成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sudo npm install n -g</div><div class="line">sudo n stable</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>上面代码通过n模块，将node.js更新为最新发布的稳定版。</p>
<p>n模块也可以指定安装的版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sudo n 0.8.21</div></pre></td></tr></table></figure>
<h3 id="版本管理工具nvm"><a href="#版本管理工具nvm" class="headerlink" title="版本管理工具nvm"></a>版本管理工具nvm</h3><p>如果想在同一台机器，同时运行多个版本的node.js，就需要用到版本管理工具nvm。</p>
<p>首先，需要安装nvm。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">git <span class="built_in">clone</span> https://github.com/creationix/nvm.git ~/.nvm</div></pre></td></tr></table></figure>
<p>然后使用下面的命令，激活nvm。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">source</span> ~/.nvm/nvm.sh</div></pre></td></tr></table></figure>
<p>上面这条命令，每次使用nvm前都要输入，建议将其加入~/.bashrc文件（假定你所使用的shell是bash）。</p>
<p>激活nvm之后，就可以安装指定版本的node.js。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">nvm install 0.10</div></pre></td></tr></table></figure>
<p>上面这条命令，安装最新的v0.10.x版本的node.js。</p>
<p>安装后，就可以指定使用该版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">nvm use 0.10</div></pre></td></tr></table></figure>
<p>或者，直接进入该版本的REPL环境。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">nvm run 0.10</div></pre></td></tr></table></figure>
<p>如果在项目根目录下新建一个.nvmrc文件，将版本号写入其中，则nvm use命令就不再需要附加版本号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">nvm use</div></pre></td></tr></table></figure>
<p>ls命令用于查看本地所安装的版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">nvm ls</div></pre></td></tr></table></figure>
<p>ls-remote命令用于查看服务器上所有可供安装的版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">nvm ls-remote</div></pre></td></tr></table></figure>
<p>如果要退出已经激活的nvm，使用deactivate命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">nvm deactivate</div></pre></td></tr></table></figure>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>安装完成后，运行node.js程序，就是使用node命令读取JavaScript脚本。</p>
<p>假定当前目录有一个demo.js的脚本文件，运行时这样写。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">node demo</div><div class="line"></div><div class="line">// 或者</div><div class="line"></div><div class="line">node demo.js</div></pre></td></tr></table></figure>
<h3 id="REPL环境"><a href="#REPL环境" class="headerlink" title="REPL环境"></a>REPL环境</h3><p>在命令行键入node命令，后面没有文件名，就进入一个Node.js的REPL环境（Read–eval–print loop，”读取-求值-输出”循环），可以直接运行各种JavaScript命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">node</div><div class="line">&gt; 1+1</div><div class="line">2</div></pre></td></tr></table></figure>
<p>如果使用参数 –use_strict，则REPL将在严格模式下运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">node --use_strict</div></pre></td></tr></table></figure>
<p>这个REPL是Node.js与用户互动的shell，各种基本的shell功能都可以在里面使用，比如使用上下方向键遍历曾经使用过的命令。特殊变量下划线（_）表示上一个命令的返回结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&gt; 1+1</div><div class="line">2</div><div class="line">&gt; _+1</div><div class="line">3</div></pre></td></tr></table></figure>
<p>在REPL中，如果运行一个表达式，会直接在命令行返回结果，如果运行一条语句则不会，因为它没有返回值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&gt; x = 1</div><div class="line">1</div><div class="line">&gt; var x = 1</div></pre></td></tr></table></figure>
<p>上面代码的第二条命令，没有显示任何结果。因为这是一条语句，不是表达式，所以没有返回值。</p>
<h3 id="异步操作"><a href="#异步操作" class="headerlink" title="异步操作"></a>异步操作</h3><p>Node采用V8引擎处理JavaScript脚本，最大特点就是单线程运行，一次只能运行一个任务。这导致Node大量采用异步操作（asynchronous opertion），即任务不是马上执行，而是插在任务队列的尾部，等到前面的任务运行完后再执行。</p>
<p>由于这种特性，某一个任务的后续操作，往往采用回调函数（callback）的形式进行定义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> isTrue = <span class="function"><span class="keyword">function</span>(<span class="params">value, callback</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (value === <span class="literal">true</span>) &#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">"Value was true."</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span> &#123;</div><div class="line">    callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Value is not true!"</span>));</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码就把进一步的处理，交给回调函数callback。约定俗成，callback的位置总是最后一个参数。值得注意的是，callback的格式也有约定。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span> (<span class="params">error, value</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (error) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(error);</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">console</span>.log(value);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>callback的第一个参数是一个Error对象，第二个参数才是真正的数据。如果没有发生错误，第一个参数就传入null。这种写法有一个很大的好处，就是说只要判断回调函数的第一个参数，就知道有没有出错，如果不是null，就肯定出错了。</p>
<h3 id="全局对象和全局变量"><a href="#全局对象和全局变量" class="headerlink" title="全局对象和全局变量"></a>全局对象和全局变量</h3><p>Node提供以下一些全局对象，它们是所有模块都可以调用的。</p>
<ul>
<li><strong>global</strong>：表示Node所在的全局环境，类似于浏览器中的window对象。</li>
<li><strong>process</strong>：指向Node内置的process模块，允许开发者与当前进程互动。</li>
<li><strong>console</strong>：指向Node内置的console模块，提供命令行环境中的标准输入、标准输出功能。</li>
</ul>
<p>全局函数：</p>
<ul>
<li><strong>定时器函数</strong>：共有4个，分别是setTimeout(), clearTimeout(), setInterval(), clearInterval()。</li>
<li><strong>require</strong>：用于加载模块。</li>
</ul>
<p>全局变量：</p>
<ul>
<li><strong>_filename</strong>：指向当前运行的脚本文件名。</li>
<li><strong>_dirname</strong>：指向当前运行的脚本所在的目录。</li>
</ul>
<p>除此之外，还有一些对象实际上是模块内部的局部变量，指向的对象根据模块不同而不同，但是所有模块都适用，可以看作是伪全局变量，主要为module, module.exports, exports等。</p>
<p>module变量指代当前模块。module.exports变量表示当前模块对外输出的接口，其他文件加载该模块，实际上就是读取module.exports变量。</p>
<ul>
<li>module.id 模块的识别符，通常是模块的文件名。</li>
<li>module.filename 模块的文件名。</li>
<li>module.loaded 返回一个布尔值，表示模块是否已经完成加载。</li>
<li>module.parent 返回使用该模块的模块。</li>
<li>module.children 返回一个数组，表示该模块要用到的其他模块。</li>
</ul>
<p>这里需要特别指出的是，exports变量实际上是一个指向module.exports对象的链接，等同在每个模块头部，有一行这样的命令。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> exports = <span class="built_in">module</span>.exports;</div></pre></td></tr></table></figure>
<p>这造成的结果是，在对外输出模块接口时，可以向exports对象添加方法，但是不能直接将exports变量指向一个函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">exports = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>)</span>&#123; <span class="built_in">console</span>.log(x);&#125;;</div></pre></td></tr></table></figure>
<p>上面这样的写法是无效的，因为它切断了exports与module.exports之间的链接。但是，下面这样写是可以的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">exports.area = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.PI * r * r;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">exports.circumference = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="number">2</span> * <span class="built_in">Math</span>.PI * r;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>如果你觉得，exports与module.exports之间的区别很难分清，一个简单的处理方法，就是放弃使用exports，只使用module.exports。</p>
<h2 id="模块化结构"><a href="#模块化结构" class="headerlink" title="模块化结构"></a>模块化结构</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>Node.js采用模块化结构，按照<a href="http://wiki.commonjs.org/wiki/CommonJS" target="_blank" rel="external">CommonJS规范</a>定义和使用模块。模块与文件是一一对应关系，即加载一个模块，实际上就是加载对应的一个模块文件。</p>
<p>require方法用于指定加载模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> circle = <span class="built_in">require</span>(<span class="string">'./circle.js'</span>);</div></pre></td></tr></table></figure>
<p>上面代码表明，从当前目录下的circle.js文件，加载circle模块。因为require方法默认加载的就是js文件，因此可以把js后缀名省略。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> circle = <span class="built_in">require</span>(<span class="string">'./circle'</span>);</div></pre></td></tr></table></figure>
<p>require方法的参数是模块文件的名字。它分成两种情况，第一种情况是参数中含有文件路径（比如上例），这时路径是相对于当前脚本所在的目录，第二种情况是参数中不含有文件路径（比如下例）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> bar = <span class="built_in">require</span>(<span class="string">'bar'</span>);</div></pre></td></tr></table></figure>
<p>如果require方法的参数不带有路径，则node.js依次按照以下顺序，去寻找模块文件。</p>
<p>node.js依次到下面的目录，去寻找bar模块。</p>
<ul>
<li>./node_modules/bar</li>
<li>../node_modules/bar</li>
<li>../../node_modules/bar</li>
<li>/node_modules/bar</li>
</ul>
<p>可以看到，如果没有指明模块所在位置，Node会依次从当前目录向上，一级级在node_modules子目录下寻找模块。如果没有找到该模块，会抛出一个错误。这样做的好处是，不同的项目可以在自己的目录中，安装同一个模块的不同版本，而不会发生版本冲突。</p>
<p>有时候，一个模块本身就是一个目录，目录中包含多个文件。这时候，Node在package.json文件中，寻找main属性所指明的模块入口文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&#123;</div><div class="line">	<span class="string">"name"</span> : <span class="string">"bar"</span>,</div><div class="line">	<span class="string">"main"</span> : <span class="string">"./lib/bar.js"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中，模块的启动文件为lib子目录下的bar.js。当使用require(‘bar’)命令加载该模块时，实际上加载的是<code>bar/lib/some-library.js</code>文件。下面写法会起到同样效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> bar = <span class="built_in">require</span>(<span class="string">'bar/lib/bar.js'</span>)</div></pre></td></tr></table></figure>
<p>如果模块目录中没有package.json文件，node.js会尝试在模块目录中寻找index.js或index.node文件进行加载。</p>
<p>模块一旦被加载以后，就会被系统缓存。如果第二次还加载该模块，则会返回缓存中的版本，这意味着模块实际上只会执行一次。如果希望模块执行多次，则可以让模块返回一个函数，然后多次调用该函数。</p>
<h3 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h3><p>Node.js自带一系列的核心模块，下面就是其中的一部分：</p>
<ul>
<li><strong>http</strong>：提供HTTP服务器功能。</li>
<li><strong>url</strong>：解析URL。</li>
<li><strong>fs</strong>：与文件系统交互。</li>
<li><strong>querystring</strong>：解析URL的查询字符串。</li>
<li><strong>child_process</strong>：新建子进程。</li>
<li><strong>util</strong>：提供一系列实用小工具。</li>
<li><strong>path</strong>：处理文件路径。</li>
<li><strong>crypto</strong>：提供加密和解密功能，基本上是对OpenSSL的包装。</li>
</ul>
<p>这些模块可以不用安装就使用。</p>
<p>除了使用核心模块，还可以使用第三方模块，以及自定义模块。</p>
<h3 id="自定义模块"><a href="#自定义模块" class="headerlink" title="自定义模块"></a>自定义模块</h3><p>Node.js模块采用CommonJS规范。只要符合这个规范，就可以自定义模块。</p>
<p>下面是一个最简单的模块，假定新建一个foo.js文件，写入以下内容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// foo.js</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(x);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>上面代码就是一个模块，它通过module.exports变量，对外输出一个方法。</p>
<p>这个模块的使用方法如下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// index.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> m = <span class="built_in">require</span>(<span class="string">'./foo'</span>);</div><div class="line"></div><div class="line">m(<span class="string">"这是自定义模块"</span>);</div></pre></td></tr></table></figure>
<p>上面代码通过require命令加载模块文件foo.js（后缀名省略），将模块的对外接口输出到变量m，然后调用m。这时，在命令行下运行index.js，屏幕上就会输出“这是自定义模块”。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">node index</div><div class="line"><span class="comment"># 这是自定义模块</span></div></pre></td></tr></table></figure>
<p>module变量是整个模块文件的顶层变量，它的exports属性就是模块向外输出的接口。如果直接输出一个函数（就像上面的foo.js），那么调用模块就是调用一个函数。但是，模块也可以输出一个对象。下面对foo.js进行改写。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// foo.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> out = <span class="keyword">new</span> <span class="built_in">Object</span>();</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">p</span>(<span class="params">string</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(string);</div><div class="line">&#125;</div><div class="line"></div><div class="line">out.print = p;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = out;</div></pre></td></tr></table></figure>
<p>上面的代码表示模块输出out对象，该对象有一个print属性，指向一个函数。下面是这个模块的使用方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// index.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> m = <span class="built_in">require</span>(<span class="string">'./foo'</span>);</div><div class="line"></div><div class="line">m.print(<span class="string">"这是自定义模块"</span>);</div></pre></td></tr></table></figure>
<p>上面代码表示，由于具体的方法定义在模块的print属性上，所以必须显式调用print属性。</p>
<h2 id="fs模块"><a href="#fs模块" class="headerlink" title="fs模块"></a>fs模块</h2><p>fs是filesystem的缩写，该模块提供本地文件的读写能力。</p>
<p><strong>（1）readfile方法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line">fs.readFile(<span class="string">'example_log.txt'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, logData</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> text = logData.toString();</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码使用readFile方法读取文件。readFile方法的第一个参数是文件名，第二个参数是回调函数。这两个参数中间，还可以插入一个可选参数，表示文件的编码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">fs.readFile(<span class="string">'example_log.txt'</span>, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, logData</span>) </span>&#123;</div><div class="line">	<span class="comment">// ...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>可用的文件编码包括“ascii”、“utf8”和“base64”。如果这个参数没有提供，默认是utf8。</p>
<p><strong>（2）readFileSync方法</strong></p>
<p>如果想要同步读取文件，可以使用readFileSync方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> data = fs.readFileSync(<span class="string">'./file.json'</span>);</div></pre></td></tr></table></figure>
<p><strong>（3）writeFile方法</strong></p>
<p>写入文件要使用writeFile方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">fs.writeFile(<span class="string">'./file.txt'</span>, data, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) &#123;</div><div class="line">      <span class="built_in">console</span>.log(err.message);</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Saved successfully.'</span>);</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
<p><strong>（4）readdir方法</strong></p>
<p>readdir方法用于读取目录，返回一个所包含的文件和子目录的数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">fs.readdir(process.cwd(), <span class="function"><span class="keyword">function</span> (<span class="params">err, files</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) &#123;</div><div class="line">    <span class="built_in">console</span>.log(err);</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> count = files.length;</div><div class="line">  <span class="keyword">var</span> results = &#123;&#125;;</div><div class="line">  files.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">filename</span>) </span>&#123;</div><div class="line">    fs.readFile(filename, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">      results[filename] = data;</div><div class="line">      count--;</div><div class="line">      <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// 对所有文件进行处理</span></div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>（5）fs.exists(path, callback)</strong></p>
<p>exists方法用来判断给定路径是否存在，然后不管结果如何，都会调用回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">fs.exists(<span class="string">'/path/to/file'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">exists</span>) </span>&#123;</div><div class="line">  util.debug(exists ? <span class="string">"it's there"</span> : <span class="string">"no file!"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码表明，回调函数的参数是一个表示文件是否存在的布尔值。</p>
<p>需要注意的是，不要在open方法之前调用exists方法，open方法本身就能检查文件是否存在。</p>
<p>下面的例子是如果给定目录存在，就删除它。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">if</span>(fs.exists(outputFolder)) &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"Removing "</span>+outputFolder);</div><div class="line">  fs.rmdir(outputFolder);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Stream模式"><a href="#Stream模式" class="headerlink" title="Stream模式"></a>Stream模式</h3><p>Stream是数据处理的一种形式，可以用来取代回调函数。举例来说，传统形式的文件处理，必须先将文件全部读入内存，然后调用回调函数，如果遇到大文件，整个过程将非常耗时。Stream则是将文件分成小块读入内存，每读入一次，都会触发相应的事件。只要监听这些事件，就能掌握进展，做出相应处理，这样就提高了性能。Node内部的很多IO处理都采用Stream，比如HTTP连接、文件读写、标准输入输出。</p>
<p>Stream既可以读取数据，也可以写入数据。读写数据时，每读入（或写入）一段数据，就会触发一次data事件，全部读取（或写入）完毕，触发end事件。如果发生错误，则触发error事件。</p>
<p>fs模块的createReadStream方法用于新建读取数据流，createWriteStream方法用于新建写入数据流。使用这两个方法，可以做出一个用于文件复制的脚本copy.js。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// copy.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="built_in">console</span>.log(process.argv[<span class="number">2</span>], <span class="string">'-&gt;'</span>, process.argv[<span class="number">3</span>]);</div><div class="line"></div><div class="line"><span class="keyword">var</span> readStream = fs.createReadStream(process.argv[<span class="number">2</span>]);</div><div class="line"><span class="keyword">var</span> writeStream = fs.createWriteStream(process.argv[<span class="number">3</span>]);</div><div class="line"></div><div class="line">readStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</div><div class="line">  writeStream.write(chunk);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">readStream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  writeStream.end();</div><div class="line">&#125;);</div><div class="line"></div><div class="line">readStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"ERROR"</span>, err);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">writeStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"ERROR"</span>, err);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码非常容易理解，使用的时候直接提供源文件路径和目标文件路径，就可以了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">node cp.js src.txt dest.txt</div></pre></td></tr></table></figure>
<p>Streams对象都具有pipe方法，起到管道作用，将一个数据流输入另一个数据流。所以，上面代码可以重写成下面这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="built_in">console</span>.log(process.argv[<span class="number">2</span>], <span class="string">'-&gt;'</span>, process.argv[<span class="number">3</span>]);</div><div class="line"></div><div class="line"><span class="keyword">var</span> readStream = fs.createReadStream(process.argv[<span class="number">2</span>]);</div><div class="line"><span class="keyword">var</span> writeStream = fs.createWriteStream(process.argv[<span class="number">3</span>]);</div><div class="line"></div><div class="line">readStream.on(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  readStream.pipe(writeStream);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">readStream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  writeStream.end();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="http模块"><a href="#http模块" class="headerlink" title="http模块"></a>http模块</h2><h3 id="实例：搭建一个HTTP服务器"><a href="#实例：搭建一个HTTP服务器" class="headerlink" title="实例：搭建一个HTTP服务器"></a>实例：搭建一个HTTP服务器</h3><p>使用Node.js搭建HTTP服务器非常简单。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>)</span>&#123;</div><div class="line">  response.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</div><div class="line">  response.end(<span class="string">'Hello World\n'</span>);</div><div class="line">&#125;).listen(<span class="number">8080</span>, <span class="string">"127.0.0.1"</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server running on port 8080.'</span>);</div></pre></td></tr></table></figure>
<p>上面代码第一行 var http = require(“http”)，表示加载http模块。然后，调用http模块的createServer方法，创造一个服务器实例，将它赋给变量http。</p>
<p>ceateServer方法接受一个函数作为参数，该函数的req参数是一个对象，表示客户端的HTTP请求；res参数也是一个对象，表示服务器端的HTTP回应。rese.writeHead方法表示，服务器端回应一个HTTP头信息；response.end方法表示，服务器端回应的具体内容，以及回应完成后关闭本次对话。最后的listen(8080)表示启动服务器实例，监听本机的8080端口。</p>
<p>将上面这几行代码保存成文件app.js，然后用node调用这个文件，服务器就开始运行了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">node app.js</div></pre></td></tr></table></figure>
<p>这时命令行窗口将显示一行提示“Server running at port 8080.”。打开浏览器，访问<a href="http://localhost:8080，网页显示“Hello" target="_blank" rel="external">http://localhost:8080，网页显示“Hello</a> world!”。</p>
<p>上面的例子是当场生成网页，也可以事前写好网页，存在文件中，然后利用fs模块读取网页文件，将其返回。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>)</span>&#123;</div><div class="line"></div><div class="line">  fs.readFile(<span class="string">'data.txt'</span>, <span class="function"><span class="keyword">function</span> <span class="title">readData</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">    response.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</div><div class="line">    response.end(data);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">&#125;).listen(<span class="number">8080</span>, <span class="string">"127.0.0.1"</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server running on port 8080.'</span>);</div></pre></td></tr></table></figure>
<p>下面的修改则是根据不同网址的请求，显示不同的内容，已经相当于做出一个网站的雏形了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// 主页</span></div><div class="line">  <span class="keyword">if</span> (req.url == <span class="string">"/"</span>) &#123;</div><div class="line">    res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span> &#125;);</div><div class="line">    res.end(<span class="string">"Welcome to the homepage!"</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// About页面</span></div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (req.url == <span class="string">"/about"</span>) &#123;</div><div class="line">    res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span> &#125;);</div><div class="line">    res.end(<span class="string">"Welcome to the about page!"</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 404错误</span></div><div class="line">  <span class="keyword">else</span> &#123;</div><div class="line">    res.writeHead(<span class="number">404</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span> &#125;);</div><div class="line">    res.end(<span class="string">"404 error! File not found."</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;).listen(<span class="number">8080</span>, <span class="string">"localhost"</span>);</div></pre></td></tr></table></figure>
<p>回调函数的req（request）对象，拥有以下属性。</p>
<ul>
<li>url：发出请求的网址。</li>
<li>method：HTTP请求的方法。</li>
<li>headers：HTTP请求的所有HTTP头信息。</li>
</ul>
<h3 id="处理POST请求"><a href="#处理POST请求" class="headerlink" title="处理POST请求"></a>处理POST请求</h3><p>当客户端采用POST方法发送数据时，服务器端可以对data和end两个事件，设立监听函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> content = <span class="string">""</span>;</div><div class="line"></div><div class="line">  req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</div><div class="line">    content += chunk;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;);</div><div class="line">	res.write(<span class="string">"You've sent: "</span> + content);</div><div class="line">    res.end();</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">&#125;).listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure>
<p>data事件会在数据接收过程中，每收到一段数据就触发一次，接收到的数据被传入回调函数。end事件则是在所有数据接收完成后触发。</p>
<h3 id="发出请求：request方法"><a href="#发出请求：request方法" class="headerlink" title="发出请求：request方法"></a>发出请求：request方法</h3><p>request方法用于发出HTTP请求。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line"><span class="comment">//The url we want is: 'www.random.org/integers/?num=1&amp;min=1&amp;max=10&amp;col=1&amp;base=10&amp;format=plain&amp;rnd=new'</span></div><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">  <span class="attr">host</span>: <span class="string">'www.random.org'</span>,</div><div class="line">  <span class="attr">path</span>: <span class="string">'/integers/?num=1&amp;min=1&amp;max=10&amp;col=1&amp;base=10&amp;format=plain&amp;rnd=new'</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">callback = <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> str = <span class="string">''</span>;</div><div class="line"></div><div class="line">  <span class="comment">//another chunk of data has been recieved, so append it to `str`</span></div><div class="line">  response.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</div><div class="line">    str += chunk;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">//the whole response has been recieved, so we just print it out here</span></div><div class="line">  response.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(str);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> req = http.request(options, callback);</div><div class="line"></div><div class="line">req.write(<span class="string">"hello world!"</span>);</div><div class="line">req.end();</div></pre></td></tr></table></figure>
<p>request对象的第一个参数是options对象，用于指定请求的域名和路径，第二个参数是请求完成后的回调函数。</p>
<p>如果使用POST方法发出请求，只需在options对象中设定即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">  <span class="attr">host</span>: <span class="string">'www.example.com'</span>,</div><div class="line">  <span class="attr">path</span>: <span class="string">'/'</span>,</div><div class="line">  <span class="attr">port</span>: <span class="string">'80'</span>,</div><div class="line">  <span class="attr">method</span>: <span class="string">'POST'</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>指定HTTP头信息，也是在options对象中设定。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">  <span class="attr">headers</span>: &#123;<span class="string">'custom'</span>: <span class="string">'Custom Header Demo works'</span>&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="搭建HTTPs服务器"><a href="#搭建HTTPs服务器" class="headerlink" title="搭建HTTPs服务器"></a>搭建HTTPs服务器</h3><p>搭建HTTPs服务器需要有SSL证书。对于向公众提供服务的网站，SSL证书需要向证书颁发机构购买；对于自用的网站，可以自制。</p>
<p>自制SSL证书需要OpenSSL，具体命令如下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">openssl genrsa -out key.pem</div><div class="line">openssl req -new -key key.pem -out csr.pem</div><div class="line">openssl x509 -req -days 9999 -in csr.pem -signkey key.pem -out cert.pem</div><div class="line">rm csr.pem</div></pre></td></tr></table></figure>
<p>上面的命令生成两个文件：ert.pem（证书文件）和 key.pem（私钥文件）。有了这两个文件，就可以运行HTTPs服务器了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">  <span class="attr">key</span>: fs.readFileSync(<span class="string">'key.pem'</span>),</div><div class="line">  <span class="attr">cert</span>: fs.readFileSync(<span class="string">'cert.pem'</span>)</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> a = https.createServer(options, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.writeHead(<span class="number">200</span>);</div><div class="line">  res.end(<span class="string">"hello world\n"</span>);</div><div class="line">&#125;).listen(<span class="number">8000</span>);</div></pre></td></tr></table></figure>
<p>上面代码显示，HTTPs服务器与HTTP服务器的最大区别，就是createServer方法多了一个options参数。运行以后，就可以测试是否能够正常访问。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">curl -k https://localhost:8000</div></pre></td></tr></table></figure>
<h2 id="events模块"><a href="#events模块" class="headerlink" title="events模块"></a>events模块</h2><h3 id="基本用法-1"><a href="#基本用法-1" class="headerlink" title="基本用法"></a>基本用法</h3><p>events模块是node.js对“发布/订阅”模式（publish/subscribe）的部署。也就说，通过events模块的EventEmitter属性，建立一个消息中心；然后通过on方法，为各种事件指定回调函数，从而将程序转为事件驱动型，各个模块之间通过事件联系。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">"events"</span>).EventEmitter;</div><div class="line"></div><div class="line"><span class="keyword">var</span> ee = <span class="keyword">new</span> EventEmitter();</div><div class="line">ee.on(<span class="string">"someEvent"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"event has occured"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">ee.emit(<span class="string">"someEvent"</span>);</div></pre></td></tr></table></figure>
<p>上面代码在加载events模块后，通过EventEmitter属性建立了一个EventEmitter对象实例，这个实例就是消息中心。然后，通过on方法为someEvent事件指定回调函数。最后，通过emit方法触发someEvent事件。</p>
<p>emit方法还接受第二个参数，用于向回调函数提供参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ee.on(<span class="string">"someEvent"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(data);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">ee.emit(<span class="string">"someEvent"</span>, data);</div></pre></td></tr></table></figure>
<p>默认情况下，Node.js允许同一个事件最多可以触发10个回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ee.on(<span class="string">"someEvent"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">"event 1"</span>); &#125;);</div><div class="line">ee.on(<span class="string">"someEvent"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">"event 2"</span>); &#125;);</div><div class="line">ee.on(<span class="string">"someEvent"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">"event 3"</span>); &#125;);</div></pre></td></tr></table></figure>
<p>超过10个回调函数，会发出一个警告。这个门槛值可以通过setMaxListeners方法改变。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ee.setMaxListeners(<span class="number">20</span>);</div></pre></td></tr></table></figure>
<p>events模块的作用，还表示在其他模块可以继承这个模块，因此也就拥有了EventEmitter接口。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">"util"</span>);</div><div class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">"events"</span>).EventEmitter;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserList</span> (<span class="params"></span>)</span>&#123;</div><div class="line">    EventEmitter.call(<span class="keyword">this</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">util.inherits(UserList, EventEmitter);</div><div class="line"></div><div class="line">UserList.prototype.save = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">	<span class="comment">// save into database</span></div><div class="line">    <span class="keyword">this</span>.emit(<span class="string">"saved-user"</span>, obj);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>上面代码新建了一个构造函数UserList，然后让其继承EventEmitter，因此UserList就拥有了EventEmitter的接口。最后，为UserList的实例定义一个save方法，表示将数据储存进数据库，在储存完毕后，使用EventEmitter接口的emit方法，触发一个saved-user事件。</p>
<h3 id="事件类型"><a href="#事件类型" class="headerlink" title="事件类型"></a>事件类型</h3><p>events模块默认支持一些事件。</p>
<ul>
<li>newListener事件：添加新的回调函数时触发。</li>
<li>removeListener事件：移除回调时触发。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ee.on(<span class="string">"newListener"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">evtName</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"New Listener: "</span> + evtName);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">ee.on(<span class="string">"removeListener"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">evtName</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"Removed Listener: "</span> + evtName);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>)</span>&#123;&#125;</div><div class="line"></div><div class="line">ee.on(<span class="string">"save-user"</span>, foo);</div><div class="line">ee.removeListener(<span class="string">"save-user"</span>, foo);</div><div class="line"></div><div class="line"><span class="comment">// New Listener: removeListener</span></div><div class="line"><span class="comment">// New Listener: save-user</span></div><div class="line"><span class="comment">// Removed Listener: save-user</span></div></pre></td></tr></table></figure>
<p>上面代码会触发两次newListener事件，以及一次removeListener事件。</p>
<h3 id="EventEmitter对象的其他方法"><a href="#EventEmitter对象的其他方法" class="headerlink" title="EventEmitter对象的其他方法"></a>EventEmitter对象的其他方法</h3><p><strong>（1）once方法</strong></p>
<p>该方法类似于on方法，但是回调函数只触发一次。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ee.once(<span class="string">"firstConnection"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"本提示只出现一次"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>（2）removeListener方法</strong></p>
<p>该方法用于移除回调函数。它接受两个参数，第一个是事件名称，第二个是回调函数名称。这就是说，不能用于移除匿名函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">onlyOnce</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"You'll never see this again"</span>);</div><div class="line">	ee.removeListener(<span class="string">"firstConnection"</span>, onlyOnce);</div><div class="line">&#125;</div><div class="line"></div><div class="line">ee.on(<span class="string">"firstConnection"</span>, onlyOnce);</div></pre></td></tr></table></figure>
<p>上面代码起到与once方法类似效果。</p>
<p><strong>（3）removeAllListeners方法</strong></p>
<p>该方法用于移除某个事件的所有回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ee.removeAllListeners(<span class="string">"firstConnection"</span>);</div></pre></td></tr></table></figure>
<p>如果不带参数，则表示移除所有事件的所有回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ee.removeAllListeners();</div></pre></td></tr></table></figure>
<p><strong>（4）listener方法</strong></p>
<p>该方法接受一个事件名称作为参数，返回该事件所有回调函数组成的数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">onlyOnce</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(ee.listeners(<span class="string">"firstConnection"</span>));</div><div class="line">	ee.removeListener(<span class="string">"firstConnection"</span>, onlyOnce);</div><div class="line">	<span class="built_in">console</span>.log(ee.listeners(<span class="string">"firstConnection"</span>));</div><div class="line">&#125;</div><div class="line"></div><div class="line">ee.on(<span class="string">"firstConnection"</span>, onlyOnce)</div><div class="line">ee.emit(<span class="string">"firstConnection"</span>);</div><div class="line">ee.emit(<span class="string">"firstConnection"</span>);</div><div class="line"></div><div class="line"><span class="comment">// [ [Function: onlyOnce] ]</span></div><div class="line"><span class="comment">// []</span></div></pre></td></tr></table></figure>
<p>上面代码显示两次回调函数组成的数组，第一次只有一个回调函数onlyOnce，第二次是一个空数组，因为removeListener方法取消了回调函数。</p>
<h2 id="process模块"><a href="#process模块" class="headerlink" title="process模块"></a>process模块</h2><p>process模块用来与当前进程互动，可以通过全局变量process访问，不必使用require命令加载。</p>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>process对象提供一系列属性，用于返回系统信息。</p>
<ul>
<li><strong>process.pid</strong>：当前进程的进程号。</li>
<li><strong>process.version</strong>：Node的版本，比如v0.10.18。</li>
<li><strong>process.platform</strong>：当前系统平台，比如Linux。</li>
<li><strong>process.title</strong>：默认值为“node”，可以自定义该值。</li>
<li><strong>process.argv</strong>：当前进程的命令行参数数组。</li>
<li><strong>process.env</strong>：指向当前shell的环境变量，比如process.env.HOME。</li>
<li><strong>process.execPath</strong>：运行当前进程的可执行文件的绝对路径。</li>
<li><strong>process.stdout</strong>：指向标准输出。</li>
<li><strong>process.stdin</strong>：指向标准输入。</li>
<li><strong>process.stderr</strong>：指向标准错误。</li>
</ul>
<p>下面是主要属性的介绍。</p>
<p><strong>(1)stdout</strong></p>
<p>process.stdout用来控制标准输出，也就是在命令行窗口向用户显示内容。它的write方法等同于console.log。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">exports.log = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    process.stdout.write(format.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>) + <span class="string">'\n'</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><strong>（2）argv</strong></p>
<p>process.argv返回命令行脚本的各个参数组成的数组。</p>
<p>先新建一个脚本文件argv.js。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// argv.js</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"argv: "</span>,process.argv);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">"argc: "</span>,process.argc);</div></pre></td></tr></table></figure>
<p>在命令行下调用这个脚本，会得到以下结果。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">node argv.js a b c</div><div class="line"># [ 'node', '/path/to/argv.js', 'a', 'b', 'c' ]</div></pre></td></tr></table></figure>
<p>上面代码表示，argv返回数组的成员依次是命令行的各个部分。要得到真正的参数部分，可以把argv.js改写成下面这样。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// argv.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> myArgs = process.argv.slice(<span class="number">2</span>);</div><div class="line"><span class="built_in">console</span>.log(myArgs);</div></pre></td></tr></table></figure>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>process对象提供以下方法：</p>
<ul>
<li><strong>process.exit()</strong>：退出当前进程。</li>
<li><strong>process.cwd()</strong>：返回运行当前脚本的工作目录的路径。_</li>
<li><strong>process.chdir()</strong>：改变工作目录。</li>
<li><strong>process.nextTick()</strong>：将一个回调函数放在下次事件循环的顶部。</li>
</ul>
<p>process.chdir()改变工作目录的例子。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">process.cwd()</div><div class="line"><span class="comment"># '/home/aaa'</span></div><div class="line"></div><div class="line">process.chdir(<span class="string">'/home/bbb'</span>)</div><div class="line"></div><div class="line">process.cwd()</div><div class="line"><span class="comment"># '/home/bbb'</span></div></pre></td></tr></table></figure>
<p>process.nextTick()的例子，指定下次事件循环首先运行的任务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">process.nextTick(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">    console.log(<span class="string">'Next event loop!'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码可以用setTimeout改写，但是nextTick的效果更高、描述更准确。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">set</span>Timeout(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">   console.log(<span class="string">'Next event loop!'</span>);</div><div class="line">&#125;, 0)</div></pre></td></tr></table></figure>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p><strong>（1）exit事件</strong></p>
<p>当前进程退出时，会触发exit事件，可以对该事件指定回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">process.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  fs.writeFileSync(<span class="string">'/tmp/myfile'</span>, <span class="string">'This MUST be saved on exit.'</span>);</div><div class="line"> &#125;);</div></pre></td></tr></table></figure>
<p><strong>（2）uncaughtException事件</strong></p>
<p>当前进程抛出一个没有被捕捉的意外时，会触发uncaughtException事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">process.on(<span class="string">'uncaughtException'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.error(<span class="string">'An uncaught error occurred!'</span>);</div><div class="line">  <span class="built_in">console</span>.error(err.stack);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="cluster模块"><a href="#cluster模块" class="headerlink" title="cluster模块"></a>cluster模块</h2><p>Node.js默认单进程运行，对于多核CPU的计算机来说，这样做效率很低，因为只有一个核在运行，其他核都在闲置。cluster模块就是为了解决这个问题而提出的。</p>
<p>cluster模块允许设立一个主进程和若干个worker进程，由主进程监控和协调worker进程的运行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>);</div><div class="line"><span class="keyword">var</span> os = <span class="built_in">require</span>(<span class="string">'os'</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (cluster.isMaster)&#123;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, n = os.cpus().length; i &lt; n; i += <span class="number">1</span>)&#123;</div><div class="line">        cluster.fork();</div><div class="line">	  &#125;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">	  http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">	    res.writeHead(<span class="number">200</span>);</div><div class="line">	    res.end(<span class="string">"hello world\n"</span>);</div><div class="line">	  &#125;).listen(<span class="number">8000</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码先判断当前进程是否为主进程（cluster.isMaster），如果是的，就按照CPU的核数，新建若干个worker进程；如果不是，说明当前进程是worker进程，则在该进程启动一个服务器程序。</p>
<h2 id="配置文件package-json"><a href="#配置文件package-json" class="headerlink" title="配置文件package.json"></a>配置文件package.json</h2><p>每个项目的根目录下面，一般都有一个package.json文件，定义了这个项目所需要的各种模块，以及项目的配置信息（比如名称、版本、许可证等元数据）。npm install 命令根据这个配置文件，自动下载所需的模块，也就是配置项目所需的运行和开发环境。</p>
<p>下面是一个最简单的package.json文件，只定义两项元数据：项目名称和项目版本。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"xxx"</span>,</div><div class="line">  <span class="string">"version"</span> : <span class="string">"0.0.0"</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码说明，package.json文件内部就是一个json对象，该对象的每一个成员就是当前项目的一项设置。比如name就是项目名称，version是版本（遵守“大版本.次要版本.小版本”的格式）。</p>
<p>下面是一个更完整的package.json文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&#123;</div><div class="line">	<span class="string">"name"</span>: <span class="string">"Hello World"</span>,</div><div class="line">	<span class="string">"version"</span>: <span class="string">"0.0.1"</span>,</div><div class="line">	<span class="string">"author"</span>: <span class="string">"张三"</span>,</div><div class="line">	<span class="string">"description"</span>: <span class="string">"第一个node.js程序"</span>,</div><div class="line">	<span class="string">"keywords"</span>:[<span class="string">"node.js"</span>,<span class="string">"javascript"</span>],</div><div class="line">	<span class="string">"repository"</span>: &#123;</div><div class="line">		<span class="string">"type"</span>: <span class="string">"git"</span>,</div><div class="line">		<span class="string">"url"</span>: <span class="string">"https://path/to/url"</span></div><div class="line">	&#125;,</div><div class="line">	<span class="string">"license"</span>:<span class="string">"MIT"</span>,</div><div class="line">	<span class="string">"engines"</span>: &#123;<span class="string">"node"</span>: <span class="string">"0.10.x"</span>&#125;,</div><div class="line">	<span class="string">"bugs"</span>:&#123;<span class="string">"url"</span>:<span class="string">"http://path/to/bug"</span>,<span class="string">"email"</span>:<span class="string">"bug@example.com"</span>&#125;,</div><div class="line">	<span class="string">"contributors"</span>:[&#123;<span class="string">"name"</span>:<span class="string">"李四"</span>,<span class="string">"email"</span>:<span class="string">"lisi@example.com"</span>&#125;],</div><div class="line">	<span class="string">"scripts"</span>: &#123;</div><div class="line">		<span class="string">"start"</span>: <span class="string">"node index.js"</span></div><div class="line">	&#125;,</div><div class="line">	<span class="string">"dependencies"</span>: &#123;</div><div class="line">		<span class="string">"express"</span>: <span class="string">"latest"</span>,</div><div class="line">		<span class="string">"mongoose"</span>: <span class="string">"~3.8.3"</span>,</div><div class="line">		<span class="string">"handlebars-runtime"</span>: <span class="string">"~1.0.12"</span>,</div><div class="line">		<span class="string">"express3-handlebars"</span>: <span class="string">"~0.5.0"</span>,</div><div class="line">		<span class="string">"MD5"</span>: <span class="string">"~1.2.0"</span></div><div class="line">	&#125;,</div><div class="line">	<span class="string">"devDependencies"</span>: &#123;</div><div class="line">		<span class="string">"bower"</span>: <span class="string">"~1.2.8"</span>,</div><div class="line">		<span class="string">"grunt"</span>: <span class="string">"~0.4.1"</span>,</div><div class="line">		<span class="string">"grunt-contrib-concat"</span>: <span class="string">"~0.3.0"</span>,</div><div class="line">		<span class="string">"grunt-contrib-jshint"</span>: <span class="string">"~0.7.2"</span>,</div><div class="line">		<span class="string">"grunt-contrib-uglify"</span>: <span class="string">"~0.2.7"</span>,</div><div class="line">		<span class="string">"grunt-contrib-clean"</span>: <span class="string">"~0.5.0"</span>,</div><div class="line">		<span class="string">"browserify"</span>: <span class="string">"2.36.1"</span>,</div><div class="line">		<span class="string">"grunt-browserify"</span>: <span class="string">"~1.3.0"</span>,</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中，有些成员的含义很明显，但有几项需要解释一下。</p>
<p><strong>（1）engines</strong></p>
<p>engines指明了该项目所需要的node.js版本。</p>
<p><strong>（2）scripts</strong></p>
<p>scripts指定了运行脚本命令的npm命令行缩写，比如start指定了运行npm run start时，所要执行的命令。</p>
<p>下面的设置指定了npm run preinstall、npm run postinstall、npm run start、npm run test时，所要执行的命令。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"preinstall"</span>: <span class="string">"echo here it comes!"</span>,</div><div class="line">    <span class="string">"postinstall"</span>: <span class="string">"echo there it goes!"</span>,</div><div class="line">    <span class="string">"start"</span>: <span class="string">"node index.js"</span>,</div><div class="line">    <span class="string">"test"</span>: <span class="string">"tap test/*.js"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>（3）dependencies，devDependencies</strong></p>
<p>dependencies和devDependencies两项，分别指定了项目运行所依赖的模块、项目开发所需要的模块。</p>
<p>dependencies和devDependencies这两项，都指向一个对象。该对象的各个成员，分别由模块名和对应的版本要求组成。对应的版本可以加上各种限定，主要有以下几种：</p>
<ul>
<li><strong>指定版本</strong>：比如1.2.2，遵循“大版本.次要版本.小版本”的格式规定，安装时只安装指定版本。</li>
<li><strong>波浪号（tilde）+指定版本</strong>：比如~1.2.2，表示安装1.2.x的最新版本（不低于1.2.2），但是不安装1.3.x，也就是说安装时不改变大版本号和次要版本号。</li>
<li><strong>插入号（caret）+指定版本</strong>：比如&#710;1.2.2，表示安装1.x.x的最新版本（不低于1.2.2），但是不安装2.x.x，也就是说安装时不改变大版本号。需要注意的是，如果大版本号为0，则插入号的行为与波浪号相同，这是因为此时处于开发阶段，即使是次要版本号变动，也可能带来程序的不兼容。</li>
<li><strong>latest</strong>：安装最新版本。</li>
</ul>
<p>package.json文件可以手工编写，也可以使用npm init命令自动生成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm init</div></pre></td></tr></table></figure>
<p>这个命令采用互动方式，要求用户回答一些问题，然后在当前目录生成一个基本的package.json文件。所有问题之中，只有项目名称（name）和项目版本（version）是必填的，其他都是选填的。</p>
<p>有了package.json文件，直接使用npm install命令，就会在当前目录中安装所需要的模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm install</div></pre></td></tr></table></figure>
<p>如果一个模块不在package.json文件之中，可以单独安装这个模块，并使用相应的参数，将其写入package.json文件之中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm install express --save</div><div class="line">npm install express --save-dev</div></pre></td></tr></table></figure>
<p>上面代码表示单独安装express模块，–save参数表示将该模块写入dependencies属性，–save-dev表示将该模块写入devDependencies属性。</p>
<h2 id="模块管理器npm"><a href="#模块管理器npm" class="headerlink" title="模块管理器npm"></a>模块管理器npm</h2><h3 id="npm简介"><a href="#npm简介" class="headerlink" title="npm简介"></a>npm简介</h3><p>npm有两层含义。一层含义是Node.js的开放式模块登记和管理系统，网址为<a href="http://npmjs.org" target="_blank" rel="external">http://npmjs.org</a>。另一层含义是Node.js默认的模块管理器，是一个命令行下的软件，用来安装和管理node模块。</p>
<p>npm不需要单独安装。在安装node的时候，会连带一起安装npm。node安装完成后，可以用下面的命令，查看一下npm的帮助文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># npm命令列表</span></div><div class="line">npm <span class="built_in">help</span></div><div class="line"></div><div class="line"><span class="comment"># 各个命令的简单用法</span></div><div class="line">npm <span class="_">-l</span></div></pre></td></tr></table></figure>
<p>下面的命令分别查看npm的版本和配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm -version</div><div class="line"></div><div class="line">npm config list <span class="_">-l</span></div></pre></td></tr></table></figure>
<p>npm的版本可以在Node更新的时候一起更新。如果你想单独更新npm，使用下面的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm update -global npm</div></pre></td></tr></table></figure>
<p>上面的命令之所以最后一个参数是npm，是因为npm本身也是Node.js的一个模块。</p>
<h3 id="查看模块信息"><a href="#查看模块信息" class="headerlink" title="查看模块信息"></a>查看模块信息</h3><p>npm的info命令可以查看每个模块的具体信息。比如，查看underscore模块信息的命令是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm info underscore</div></pre></td></tr></table></figure>
<p>上面命令返回一个JavaScript对象，包含了underscore模块的详细信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&#123; <span class="attr">name</span>: <span class="string">'underscore'</span>,</div><div class="line">  <span class="attr">description</span>: <span class="string">'JavaScript\'s functional programming helper library.'</span>,</div><div class="line">  <span class="string">'dist-tags'</span>: &#123; <span class="attr">latest</span>: <span class="string">'1.5.2'</span>, <span class="attr">stable</span>: <span class="string">'1.5.2'</span> &#125;,</div><div class="line">  <span class="attr">repository</span>:</div><div class="line">   &#123; <span class="attr">type</span>: <span class="string">'git'</span>,</div><div class="line">     <span class="attr">url</span>: <span class="string">'git://github.com/jashkenas/underscore.git'</span> &#125;,</div><div class="line">  <span class="attr">homepage</span>: <span class="string">'http://underscorejs.org'</span>,</div><div class="line">  <span class="attr">main</span>: <span class="string">'underscore.js'</span>,</div><div class="line">  <span class="attr">version</span>: <span class="string">'1.5.2'</span>,</div><div class="line">  <span class="attr">devDependencies</span>: &#123; <span class="attr">phantomjs</span>: <span class="string">'1.9.0-1'</span> &#125;,</div><div class="line">  <span class="attr">licenses</span>:</div><div class="line">   &#123; <span class="attr">type</span>: <span class="string">'MIT'</span>,</div><div class="line">     <span class="attr">url</span>: <span class="string">'https://raw.github.com/jashkenas/underscore/master/LICENSE'</span> &#125;,</div><div class="line">  <span class="attr">files</span>:</div><div class="line">   [ <span class="string">'underscore.js'</span>,</div><div class="line">     <span class="string">'underscore-min.js'</span>,</div><div class="line">     <span class="string">'LICENSE'</span> ],</div><div class="line">  <span class="attr">readmeFilename</span>: <span class="string">'README.md'</span>&#125;</div></pre></td></tr></table></figure>
<p>上面这个JavaScript对象的每个成员，都可以直接从info命令查询。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm info underscore description</div><div class="line"><span class="comment"># JavaScript's functional programming helper library.</span></div><div class="line"></div><div class="line">npm info underscore homepage</div><div class="line"><span class="comment"># http://underscorejs.org</span></div><div class="line"></div><div class="line">npm info underscore version</div><div class="line"><span class="comment"># 1.5.2</span></div></pre></td></tr></table></figure>
<h3 id="模块的安装"><a href="#模块的安装" class="headerlink" title="模块的安装"></a>模块的安装</h3><p>每个模块可以“全局安装”，也可以“本地安装”。两者的差异是模块的安装位置，以及调用方法。</p>
<p>“全局安装”指的是将一个模块直接下载到Node的安装目录中，各个项目都可以调用。“本地安装”指的是将一个模块下载到当前目录的node_modules子目录，然后只有在当前目录和它的子目录之中，才能调用这个模块。一般来说，全局安装只适用于工具模块，比如npm和grunt。</p>
<p>默认情况下，npm install 命令是“本地安装”某个模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm install [package name]</div></pre></td></tr></table></figure>
<p>npm也支持直接输入github地址。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm install git://github.com/package/path.git</div><div class="line">npm install git://github.com/package/path.git<span class="comment">#0.1.0</span></div></pre></td></tr></table></figure>
<p>使用安装命令以后，模块文件将下载到当前目录的 node_modules 子目录。</p>
<p>使用global参数，可以“全局安装”某个模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sudo npm install -global [package name]</div></pre></td></tr></table></figure>
<p>global参数可以被简化成g参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sudo npm install -g [package name]</div></pre></td></tr></table></figure>
<p>install命令总是安装模块的最新版本，如果要安装模块的特定版本，可以在模块名后面加上@和版本号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm install package_name@version</div></pre></td></tr></table></figure>
<p>一旦安装了某个模块，就可以在代码中用require命令调用这个模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> backbone = <span class="built_in">require</span>(<span class="string">'backbone'</span>)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(backbone.VERSION)</div></pre></td></tr></table></figure>
<h3 id="模块的升级和删除"><a href="#模块的升级和删除" class="headerlink" title="模块的升级和删除"></a>模块的升级和删除</h3><p>npm update 命令可以升级本地安装的模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm update [package name]</div></pre></td></tr></table></figure>
<p>加上global参数，可以升级全局安装的模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm update -global [package name]</div></pre></td></tr></table></figure>
<p>npm uninstall 命令，删除本地安装的模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm uninstall [package name]</div></pre></td></tr></table></figure>
<p>加上global参数，可以删除全局安装的模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sudo npm uninstall [package name] -global</div></pre></td></tr></table></figure>
<h3 id="npm-list：列出当前项目的模块"><a href="#npm-list：列出当前项目的模块" class="headerlink" title="npm list：列出当前项目的模块"></a>npm list：列出当前项目的模块</h3><p>npm list命令，默认列出当前目录安装的所有模块。如果使用global参数，就是列出全局安装的模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm list</div><div class="line"></div><div class="line">npm -global list</div></pre></td></tr></table></figure>
<h3 id="npm-search：模块搜索"><a href="#npm-search：模块搜索" class="headerlink" title="npm search：模块搜索"></a>npm search：模块搜索</h3><p>向服务器端搜索某个模块，使用search命令（可使用正则搜索）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm search [搜索词]</div></pre></td></tr></table></figure>
<p>如果不加搜索词，npm search 默认返回服务器端的所有模块。</p>
<h3 id="npm-run"><a href="#npm-run" class="headerlink" title="npm run"></a>npm run</h3><p>在package.json文件有一项scripts，用于指定脚本命令，供npm直接调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"watch"</span>: <span class="string">"watchify client/main.js -o public/app.js -v"</span>,</div><div class="line">    <span class="string">"build"</span>: <span class="string">"browserify client/main.js -o public/app.js"</span>,</div><div class="line">    <span class="string">"start"</span>: <span class="string">"npm run watch &amp; nodemon server.js"</span>,</div><div class="line">	<span class="string">"test"</span>: <span class="string">"node test/all.js"</span></div><div class="line">  &#125;,</div></pre></td></tr></table></figure>
<p>上面代码在scripts项，定义了三个脚本命令，并且每个命令有一个别名。使用的时候，在命令行键入npm run后面加上别名，就能调用相应的脚本命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm run watch</div><div class="line">npm run build</div><div class="line">npm run start</div><div class="line">npm run <span class="built_in">test</span></div></pre></td></tr></table></figure>
<p>其中，start和test属于特殊命令，可以省略run。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm start</div><div class="line">npm <span class="built_in">test</span></div></pre></td></tr></table></figure>
<h3 id="npm-link"><a href="#npm-link" class="headerlink" title="npm link"></a>npm link</h3><p>一般来说，每个项目都会在项目目录内，安装所需的模块文件。也就是说，各个模块是局部安装。但是有时候，我们希望模块是一个符号链接，连到外部文件，这时候就需要用到npm link命令。</p>
<p>现在模块A（moduleA）的安装目录下运行npm link命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/path/to/moduleA $ npm link</div></pre></td></tr></table></figure>
<p>上面的命令会在npm的安装目录内，生成一个符号链接文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/usr/<span class="built_in">local</span>/share/npm/lib/node_modules/moduleA -&gt; /path/to/moduleA</div></pre></td></tr></table></figure>
<p>然后，转到你需要放置该模块的项目目录，再次运行npm link命令，并指定模块名。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/path/to/my-project  $ npm link moduleA</div></pre></td></tr></table></figure>
<p>上面命令等同于生成了本地模块的符号链接。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/path/to/my-project/node_modules/moduleA -&gt; /usr/<span class="built_in">local</span>/share/npm/lib/node_modules/moduleA</div></pre></td></tr></table></figure>
<p>然后，就可以在你的项目中，加载该模块了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">require</span>(<span class="string">'moduleA'</span>)</div></pre></td></tr></table></figure>
<p>如果你的项目不再需要该模块，可以在项目目录内使用npm unlink命令，删除符号链接。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/path/to/my-project  $ npm unlink moduleA</div></pre></td></tr></table></figure>
<h3 id="模块的发布"><a href="#模块的发布" class="headerlink" title="模块的发布"></a>模块的发布</h3><p>在发布你的模块之前，需要先设定个人信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm <span class="built_in">set</span> init.author.name <span class="string">"xxx"</span></div><div class="line">npm <span class="built_in">set</span> init.author.email <span class="string">"xxx@gmail.com"</span></div><div class="line">npm <span class="built_in">set</span> init.author.url <span class="string">"http://xxx.com"</span></div></pre></td></tr></table></figure>
<p>然后，请npm系统申请用户名。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm adduser</div></pre></td></tr></table></figure>
<p>运行上面的命令之后，屏幕上会提示输入用户名，然后是输入Email地址和密码。</p>
<p>上面所有的这些个人信息，全部保存在~/.npmrc文件之中。</p>
<p>npm模块就是一个遵循CommonJS规范的JavaScript脚本文件。此外，在模块目录中还必须有一个提供自身信息的package.json文件，一般采用npm init命令生成这个文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm init</div></pre></td></tr></table></figure>
<p>运行上面的命令，会提示回答一系列问题，结束后自动生成package.json文件。</p>
<p>package.json文件中的main属性，指定模块加载的入口文件，默认是index.js。在index.js文件中，除了模块代码以外，主要使用require命令加载其他模块，使用module.exports变量输出模块接口。</p>
<p>下面是一个例子，将HTML文件中的特殊字符转为HTML实体。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Escape special characters in the given string of html.</div><div class="line"> *</div><div class="line"> * @param  &#123;String&#125; html</div><div class="line"> * @return &#123;String&#125;</div><div class="line"> */</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">escape</span>: <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(html)</div><div class="line">      .replace(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;amp;'</span>)</div><div class="line">      .replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>)</div><div class="line">      .replace(<span class="regexp">/'/g</span>, <span class="string">'&amp;#39;'</span>)</div><div class="line">      .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)</div><div class="line">      .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>);</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Unescape special characters in the given string of html.</div><div class="line">   *</div><div class="line">   * @param  &#123;String&#125; html</div><div class="line">   * @return &#123;String&#125;</div><div class="line">   */</div><div class="line">  <span class="built_in">unescape</span>: <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(html)</div><div class="line">      .replace(<span class="regexp">/&amp;amp;/g</span>, <span class="string">'&amp;'</span>)</div><div class="line">      .replace(<span class="regexp">/&amp;quot;/g</span>, <span class="string">'"'</span>)</div><div class="line">      .replace(<span class="regexp">/&amp;#39;/g</span>, <span class="string">'\''</span>)</div><div class="line">      .replace(<span class="regexp">/&amp;lt;/g</span>, <span class="string">'&lt;'</span>)</div><div class="line">      .replace(<span class="regexp">/&amp;gt;/g</span>, <span class="string">'&gt;'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>完成代码以后，再加一个README.md文件，用来给出说明文本。</p>
<p>最后，使用npm publish命令发布。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm publish</div></pre></td></tr></table></figure>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li>Cody Lindley, <a href="http://tech.pro/tutorial/1190/package-managers-an-introductory-guide-for-the-uninitiated-front-end-developer" target="_blank" rel="external">Package Managers: An Introductory Guide For The Uninitiated Front-End Developer</a></li>
<li>Stack Overflow, <a href="http://stackoverflow.com/questions/1884724/what-is-node-js" target="_blank" rel="external">What is Node.js?</a></li>
<li>Andrew Burgess, <a href="http://dev.tutsplus.com/tutorials/using-nodes-event-module--net-35941" target="_blank" rel="external">Using Node’s Event Module</a></li>
<li>James Halliday, <a href="http://substack.net/task_automation_with_npm_run" target="_blank" rel="external">task automation with npm run</a>- Romain Prieto, <a href="http://www.asyncdev.net/2013/12/working-on-related-node-modules-locally/" target="_blank" rel="external">Working on related Node.js modules locally</a></li>
<li>Alon Salant, <a href="http://bites.goodeggs.com/posts/export-this/" target="_blank" rel="external">Export This: Interface Design Patterns for Node.js Modules</a></li>
<li>Node.js Manual &amp; Documentation, <a href="http://nodejs.org/api/modules.html" target="_blank" rel="external">Modules</a></li>
<li>Brent Ertz, <a href="http://quickleft.com/blog/creating-and-publishing-a-node-js-module" target="_blank" rel="external">Creating and publishing a node.js module</a></li>
<li>Fred K Schott, <a href="http://fredkschott.com/post/2014/02/npm-no-longer-defaults-to-tildes/" target="_blank" rel="external">“npm install –save” No Longer Using Tildes</a></li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/09/20/前端/初学foundation之joyride，交互，表格和面板.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          初学Foundation之Joyride，交互，表格和面板
        
      </div>
    </a>
  
  
    <a href="/2014/09/20/前端/初学foundation之使用sass和compass配置foundation.html" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">初学Foundation之使用Sass和Compass配置Foundation</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>






<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ddnode'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Boy
    	</div>
      	<div class="footer-right">
      		<a href="//ddnode.com/">Drupal 笔记</a>
      	</div>
    </div>
  </div>
</footer>

    </div>
    

<script src="/js/mobile.js"></script>
<script src="/js/main.js"></script>



  </div>
</body>
</html>